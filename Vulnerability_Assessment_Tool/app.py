import streamlit as st
import os
from vulnerability_scanner import run_safety_check

# Streamlit app title
st.title('Vulnerability Assessment Tool')

# Instructions
st.write("Upload your `requirements.txt` file to scan for known vulnerabilities.")

# File uploader
uploaded_file = st.file_uploader("Choose a requirements.txt file", type="txt")

# Check if file has been uploaded
if uploaded_file is not None:
    # Save the uploaded file
    with open(os.path.join("uploads", uploaded_file.name), "wb") as f:
        f.write(uploaded_file.getbuffer())

    # Run the safety check
    filepath = os.path.join("uploads", uploaded_file.name)
    vulnerabilities = run_safety_check(filepath)

    if vulnerabilities:
        st.success("Vulnerabilities found!")
        
        st.write("### Vulnerability Report")
        st.write(
            """
            | Package | Installed Version | Affected Version | Vulnerability ID | Advisory |
            |---------|-------------------|------------------|------------------|----------|
            """
        )
        for vuln in vulnerabilities:
            st.write(
                f"| {vuln['name']} | {vuln['version']} | {vuln['affected_versions']} | {vuln['vuln_id']} | {vuln['advisory']} |"
            )
    else:
        st.success("No known vulnerabilities found!")
else:
    st.info("Please upload a requirements.txt file to scan.")
